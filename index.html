<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Tic Tac Toe</title>
  <link type="text/css" rel="stylesheet" href="style.css">
  <script src="main.js"></script>
</head>

<body>
  <h2 id='title'>Tic Tac Toe</h2>
  <button id="button" onclick="startNewGame()">Start New Game</button>
  <div class="board" style="font-size: 130px">
    <div id="row-1">
      <div id="cell-0" class="cell r1 c1"></div>
      <div id="cell-1" class="cell r1 c2"></div>
      <div id="cell-2" class="cell r1 c3"></div>
    </div>
    <div id="row-2">
      <div id="cell-3" class="cell r2 c1"></div>
      <div id="cell-4" class="cell r2 c2"></div>
      <div id="cell-5" class="cell r2 c3"></div>
    </div>
    <div id="row-3">
      <div id="cell-6" class="cell r3 c1"></div>
      <div id="cell-7" class="cell r3 c2"></div>
      <div id="cell-8" class="cell r3 c3"></div>
    </div>
  </div>
  <script>

class Square { 
  constructor (id, row, column){
    this.id = id;
    this.row = row;
    this.column = column;
  }
}


let board;
let isPlayerX = true;
let count = 0;


startNewGame();

function startNewGame(){
  console.log("New Game, Player X starts")
  isPlayerX = true;
  count = 0;
  board = clearBoard();
  console.log(board)
  setupCells();
};

function clearBoard(){
  let cells = document.getElementsByClassName("cell");
  for (let cell of cells){
    cell.innerHTML = ""
  }
  let square0 = new Square('cell-0', 1, 1)
  let square1 = new Square('cell-1', 1, 2)
  let square2 = new Square('cell-2', 1, 3)
  let square3 = new Square('cell-3', 2, 1)
  let square4 = new Square('cell-4', 2, 2)
  let square5 = new Square('cell-5', 2, 3)
  let square6 = new Square('cell-6', 3, 1)
  let square7 = new Square('cell-7', 3, 2)
  let square8 = new Square('cell-8', 3, 3)
  let newBoard = [square0, square1, square2, square3, square4, square5, square6, square7, square8];
  return newBoard;
}

// determines which cell was clicked and calls addXO
function setupCells(){
  let cells = document.getElementsByClassName("cell");
  for (let cell of cells){
    console.log({cell});
    cell.onclick = function() { 
      addXO(cell)
    };
  };
};

// adds X or O to board depending on Player 1 or 2
function addXO(cell){

  for (let square of board){
    if (square.id === cell.id){
      if(isPlayerX){
        square.letter = "X"
        cell.innerHTML = "X"
      } else {
        square.letter = "O"
        cell.innerHTML = "O"
      }
    }
  }  
  console.log(board)

  if (checkWinOrTie(cell.innerHTML) === true){
    startNewGame();
  } else {
    isPlayerX = !isPlayerX;
  }
  return;
};

function fullBoard(){
  for (let square of board){
    if(square.letter === "X" || square.letter === "O"){
      count += 1;
      console.log(count)
      if(count === 9){
        return true;
      } else {
        return false;
      }
    }
  }
}

function checkWinOrTie(player){
  if(winCondition(player) === true){
    console.log("win")
    document.getElementById('title').innerHTML= "Player " + player + " Wins!!!";
    return true;
  } 
  if (fullBoard()){
    console.log("tie game");
    document.getElementById('title').innerHTML= "Tie Game!";
    return true;
  } 
  return false;
}
// needs to be refactored but works for every win condition!
function winCondition(letter){
  for (let rowIndex = 1; rowIndex < 4; rowIndex++){
    let rowArray = board.filter(square => square.row === rowIndex && square.letter === letter);
    if (rowArray.length === 3) {
      return true;
    } 
  }

  for (let columnIndex = 1; columnIndex < 4; columnIndex++){
    let columnArray = board.filter(square => square.column === columnIndex && square.letter === letter);
    if (columnArray.length === 3) {
      return true;
    }
  } 
  let diagonalArray = board.filter(square => (square.id === 'cell-0' || square.id === 'cell-4' || square.id === 'cell-8') && (square.letter === letter));

  let diagonalArray2 = board.filter(square => (square.id === 'cell-2' || square.id === 'cell-4' || square.id === 'cell-6') && (square.letter === letter));

  if(diagonalArray.length === 3 || diagonalArray2.length === 3){
    return true;
  }
  return false;
};



</script>
</body>

</html>